<div id="view-editor" class="h-full w-full flex flex-col">
    <!-- TOP TOOLBAR -->
    <div class="navbar min-h-[40px] h-[40px] px-2 z-20 border-b border-[#333] flex justify-between bg-[#232323]">
        <!-- LEFT: Back & Title -->
        <div class="flex items-center gap-4 w-1/3">
            <button id="btn-back-dashboard" class="btn btn-ghost btn-sm btn-square" title="Back">
                <span class="material-icons-round">arrow_back</span>
            </button>
            <div class="flex flex-col justify-center">
                <span id="editor-slider-name" class="font-bold text-sm leading-none mb-0.5">My Slider</span>
                <span class="text-[10px] opacity-50 leading-none">AUTOSAVED</span>
            </div>
        </div>

        <!-- CENTER: Device Switcher -->
        <div class="flex justify-center w-1/3">
            <div class="join">
                <button class="btn btn-sm btn-ghost join-item active h-8 min-h-[32px]"
                    onclick="window.LexSlider.setDevice('desktop')" title="Desktop">
                    <span class="material-icons-round text-base">desktop_windows</span>
                </button>
                <button class="btn btn-sm btn-ghost join-item h-8 min-h-[32px]"
                    onclick="window.LexSlider.setDevice('tablet')" title="Tablet">
                    <span class="material-icons-round text-base">tablet_mac</span>
                </button>
                <button class="btn btn-sm btn-ghost join-item h-8 min-h-[32px]"
                    onclick="window.LexSlider.setDevice('mobile')" title="Mobile">
                    <span class="material-icons-round text-base">smartphone</span>
                </button>
            </div>

            <!-- Undo/Redo -->
            <div class="divider divider-horizontal mx-1"></div>
            <div class="join">
                <button id="btn-undo" class="btn btn-sm btn-ghost join-item h-8 min-h-[32px] btn-disabled"
                    onclick="window.LexSlider.undo(); window.LexSlider.updateUndoRedoButtons();" title="Undo (Ctrl+Z)">
                    <span class="material-icons-round text-base">undo</span>
                </button>
                <button id="btn-redo" class="btn btn-sm btn-ghost join-item h-8 min-h-[32px] btn-disabled"
                    onclick="window.LexSlider.redo(); window.LexSlider.updateUndoRedoButtons();" title="Redo (Ctrl+Y)">
                    <span class="material-icons-round text-base">redo</span>
                </button>
                <button id="btn-history" class="btn btn-sm btn-ghost join-item h-8 min-h-[32px]"
                    onclick="window.LexSlider.toggleHistoryPanel();" title="History Panel">
                    <span class="material-icons-round text-base">history</span>
                </button>
            </div>
        </div>

        <!-- RIGHT: Actions -->
        <div class="flex justify-end gap-2 w-1/3">
            <button id="btn-new-slide" class="btn btn-success btn-sm gap-2 text-white"
                onclick="window.LexSlider.addSlide()">
                <span class="material-icons-round text-sm">add_photo_alternate</span> <span class="hidden sm:inline">New
                    Slide</span>
            </button>
            <button id="btn-preview" class="btn btn-ghost btn-sm gap-2" onclick="window.LexSlider.preview()">
                <span class="material-icons-round text-sm">play_arrow</span> <span
                    class="hidden sm:inline">Preview</span>
            </button>
            <button id="btn-save-slider" class="btn btn-primary btn-sm gap-2">
                <span class="material-icons-round text-sm">save</span> <span class="hidden sm:inline">Save</span>
            </button>
        </div>
    </div>

    <!-- MIDDLE WORKSPACE (Canvas + Sidebar) -->
    <div class="flex-1 flex overflow-hidden">
        <!-- CENTER: CANVAS -->
        <div class="flex-1 bg-base-100 relative overflow-hidden flex items-center justify-center p-8" id="canvas-area">
            <!-- Rulers (populated by CanvasRenderer.js) -->
            <div id="canvas-ruler-h"
                class="absolute top-0 left-6 right-0 h-6 bg-base-200 border-b border-base-300 z-10 overflow-hidden">
            </div>
            <div id="canvas-ruler-v"
                class="absolute top-6 left-0 bottom-0 w-6 bg-base-200 border-r border-base-300 z-10 overflow-hidden">
            </div>

            <div class="canvas-wrapper shadow-2xl relative z-0">
                <div id="editor-canvas" class="editor-canvas desktop bg-white transition-all duration-300">
                    <div id="canvas-content" class="canvas-content w-full h-full relative overflow-hidden"></div>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDEBAR: PROPERTIES -->
        <div class="splitter-h" id="splitter-sidebar"></div>
        <aside class="w-80 bg-base-200 border-l border-base-300 flex flex-col z-10 shadow-lg" id="sidebar-panel">
            <!-- SIDEBAR TABS -->
            <div class="tabs tabs-boxed bg-[#1a1a1a] p-1 m-1 rounded-lg">
                <a class="tab tab-sm flex-1 tab-active" id="sidebar-tab-layers"
                    onclick="window.LexSlider.switchSidebarTab('layers')">
                    <span class="material-icons-round text-sm mr-1">layers</span>Layers
                </a>
                <a class="tab tab-sm flex-1" id="sidebar-tab-history"
                    onclick="window.LexSlider.switchSidebarTab('history')">
                    <span class="material-icons-round text-sm mr-1">history</span>History
                </a>
            </div>

            <!-- TAB CONTENT: LAYERS -->
            <div id="sidebar-content-layers" class="flex flex-col flex-1 overflow-hidden">
                <!-- ADD LAYERS PANEL -->
                <div class="p-3 border-b border-[#333] bg-[#232323]">
                    <!-- Basic Layers -->
                    <div class="text-[9px] font-bold opacity-50 mb-2 uppercase tracking-wider flex items-center gap-1">
                        <span class="material-icons-round text-[10px]">layers</span> Content
                    </div>
                    <div class="grid grid-cols-4 gap-1.5 mb-3">
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1"
                            onclick="editor.addLayer('heading')" title="Heading">
                            <span class="material-icons-round text-base">title</span>
                            <span class="text-[8px] opacity-60">Heading</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1" onclick="editor.addLayer('text')"
                            title="Text">
                            <span class="material-icons-round text-base">text_fields</span>
                            <span class="text-[8px] opacity-60">Text</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1" onclick="editor.addLayer('image')"
                            title="Image">
                            <span class="material-icons-round text-base">image</span>
                            <span class="text-[8px] opacity-60">Image</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1"
                            onclick="editor.addLayer('button')" title="Button">
                            <span class="material-icons-round text-base">smart_button</span>
                            <span class="text-[8px] opacity-60">Button</span>
                        </button>
                    </div>

                    <!-- Media Layers -->
                    <div class="text-[9px] font-bold opacity-50 mb-2 uppercase tracking-wider flex items-center gap-1">
                        <span class="material-icons-round text-[10px]">play_circle</span> Media
                    </div>
                    <div class="grid grid-cols-4 gap-1.5 mb-3">
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1" onclick="editor.addLayer('video')"
                            title="Video">
                            <span class="material-icons-round text-base">videocam</span>
                            <span class="text-[8px] opacity-60">Video</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1" onclick="editor.addLayer('audio')"
                            title="Audio">
                            <span class="material-icons-round text-base">audiotrack</span>
                            <span class="text-[8px] opacity-60">Audio</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1" onclick="editor.addLayer('icon')"
                            title="Icon">
                            <span class="material-icons-round text-base">star</span>
                            <span class="text-[8px] opacity-60">Icon</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1"
                            onclick="editor.addLayer('lottie')" title="Lottie">
                            <span class="material-icons-round text-base">animation</span>
                            <span class="text-[8px] opacity-60">Lottie</span>
                        </button>
                    </div>

                    <!-- Special Layers -->
                    <div class="text-[9px] font-bold opacity-50 mb-2 uppercase tracking-wider flex items-center gap-1">
                        <span class="material-icons-round text-[10px]">auto_awesome</span> Special
                    </div>
                    <div class="grid grid-cols-4 gap-1.5 mb-3">
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1" onclick="editor.addLayer('shape')"
                            title="Shape">
                            <span class="material-icons-round text-base">crop_square</span>
                            <span class="text-[8px] opacity-60">Shape</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1"
                            onclick="editor.addLayer('divider')" title="Divider">
                            <span class="material-icons-round text-base">horizontal_rule</span>
                            <span class="text-[8px] opacity-60">Divider</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1"
                            onclick="editor.addLayer('countdown')" title="Countdown">
                            <span class="material-icons-round text-base">timer</span>
                            <span class="text-[8px] opacity-60">Timer</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1"
                            onclick="editor.addLayer('social')" title="Social Icons">
                            <span class="material-icons-round text-base">share</span>
                            <span class="text-[8px] opacity-60">Social</span>
                        </button>
                    </div>

                    <!-- Structure Layers -->
                    <div class="text-[9px] font-bold opacity-50 mb-2 uppercase tracking-wider flex items-center gap-1">
                        <span class="material-icons-round text-[10px]">dashboard</span> Structure
                    </div>
                    <div class="grid grid-cols-4 gap-1.5">
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1"
                            onclick="window.LexSlider.groupLayers()" title="Group">
                            <span class="material-icons-round text-base">folder</span>
                            <span class="text-[8px] opacity-60">Group</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1" onclick="editor.addLayer('row')"
                            title="Row Layout">
                            <span class="material-icons-round text-base">view_column</span>
                            <span class="text-[8px] opacity-60">Row</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1" onclick="editor.addLayer('html')"
                            title="Custom HTML">
                            <span class="material-icons-round text-base">code</span>
                            <span class="text-[8px] opacity-60">HTML</span>
                        </button>
                        <button class="btn btn-outline btn-xs h-9 flex-col gap-0 p-1 btn-disabled opacity-30"
                            title="More coming soon">
                            <span class="material-icons-round text-base">more_horiz</span>
                            <span class="text-[8px] opacity-60">More</span>
                        </button>
                    </div>
                </div>

                <!-- SCROLLABLE PROPERTIES -->
                <div class="flex-1 overflow-y-auto p-0 custom-scrollbar" id="property-inspector">
                    <div class="h-full flex flex-col items-center justify-center text-base-content/30 p-8 text-center">
                        <span class="material-icons-round text-5xl mb-2">touch_app</span>
                        <p class="text-xs">Select a layer to edit properties</p>
                    </div>
                </div>
            </div>

            <!-- TAB CONTENT: HISTORY -->
            <div id="sidebar-content-history" class="flex-1 overflow-hidden hidden">
                <div id="historyPanelContainer" class="h-full"></div>
            </div>
        </aside>
    </div>

    <!-- BOTTOM PANEL: TIMELINE -->
    <div class="splitter-v" id="splitter-timeline"></div>
    <div id="timeline-panel" style="height: 300px;"
        class="bg-base-200 border-t border-base-300 flex flex-col z-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
        <!-- Timeline Header & Controls -->
        <div class="h-10 border-b border-base-300 flex items-center px-2 bg-base-200 select-none">
            <div class="flex items-center gap-2 mr-4">
                <span class="material-icons-round text-primary text-sm">movie</span>
                <span class="text-xs font-bold">Timeline</span>
            </div>
            <div class="join mr-4">
                <button class="btn btn-xs btn-ghost join-item" id="tl-btn-play"><span
                        class="material-icons-round text-sm">play_arrow</span></button>
                <button class="btn btn-xs btn-ghost join-item hidden" id="tl-btn-pause"><span
                        class="material-icons-round text-sm">pause</span></button>
                <button class="btn btn-xs btn-ghost join-item" id="tl-btn-stop"><span
                        class="material-icons-round text-sm">stop</span></button>
            </div>
            <span class="font-mono text-xs bg-base-300 px-2 py-1 rounded text-primary"
                id="tl-time-display">00:00.00</span>
            <div class="divider divider-horizontal mx-1 my-1"></div>
            <div class="flex items-center gap-2">
                <span class="text-[10px] opacity-50">DUR:</span>
                <input type="number" id="tl-duration-input" value="5000" step="100"
                    class="input input-xs input-bordered w-16 text-right font-mono"
                    onchange="window.LexSlider.updateSlideDuration(this.value)">
                <span class="text-[10px] opacity-50">ms</span>
            </div>
            <div class="flex items-center gap-2 ml-2 border-l border-base-300 pl-2">
                <span class="text-[10px] opacity-50">SPEED:</span>
                <select id="tl-speed-input" class="select select-bordered select-xs w-16 px-1"
                    onchange="window.LexSlider.setPlaybackSpeed(this.value)">
                    <option value="0.25">0.25x</option>
                    <option value="0.5">0.5x</option>
                    <option value="1.0" selected>1x</option>
                    <option value="2.0">2x</option>
                </select>
            </div>
            <div class="flex-1"></div>
            <div class="join mr-2">
                <button class="btn btn-xs btn-ghost join-item" id="tl-btn-snap"
                    onclick="window.LexSlider.toggleTimelineSnap()" title="Toggle Snap">
                    <span class="material-icons-round text-sm opacity-50">magnet_alt</span>
                </button>
            </div>
            <div class="join">
                <button class="btn btn-xs btn-ghost join-item" onclick="window.LexSlider.timelineZoom(-0.5)"><span
                        class="material-icons-round text-sm">zoom_out</span></button>
                <button class="btn btn-xs btn-ghost join-item" onclick="window.LexSlider.timelineZoom(0.5)"><span
                        class="material-icons-round text-sm">zoom_in</span></button>
            </div>
        </div>

        <!-- Timeline Body -->
        <div class="flex-1 flex overflow-hidden">
            <!-- LEFT: TREE VIEW (no scroll, synced via JS) -->
            <div class="w-64 border-r border-base-300 bg-base-200 flex flex-col overflow-hidden"
                id="timeline-tree-wrapper">
                <!-- Spacer for ruler alignment -->
                <div class="h-6 border-b border-base-300 bg-base-200 shrink-0"></div>
                <!-- Tree content -->
                <div class="flex-1 overflow-hidden" id="timeline-tree"
                    style="overflow-y: scroll; scrollbar-width: none; -ms-overflow-style: none;">
                </div>
            </div>
            <!-- RIGHT: TRACKS -->
            <div class="flex-1 flex flex-col overflow-hidden bg-base-100 relative">
                <div class="h-6 border-b border-base-300 bg-base-200 relative overflow-hidden select-none"
                    id="tl-ruler-container">
                    <div id="tl-ruler" class="h-full relative"></div>
                    <div id="tl-playhead"
                        class="absolute top-0 bottom-0 w-[1px] bg-primary z-50 pointer-events-none h-[1000px]"></div>
                </div>
                <!-- Tracks -->
                <div class="flex-1 overflow-auto custom-scrollbar relative bg-[#1e1e1e]" id="tl-tracks-scroll">
                    <div id="tl-tracks" class="min-w-full min-h-full relative">
                        <!-- Tracks injected here -->
                    </div>
                    <div id="tl-playhead" class="absolute top-0 bottom-0 w-px bg-error z-50 pointer-events-none"
                        style="left: 0;"></div>
                    <div id="tl-snap-line"
                        class="absolute top-0 bottom-0 w-px bg-primary z-50 hidden pointer-events-none"
                        style="left: 0;"></div>
                </div>
            </div>
        </div>
    </div>
</div>